<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”å’Œç¡ç¡ğŸ’¤çš„ç¶²è·¯å°è§’è½ - æ•¸ä½å›æ†¶æ›¸</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="InternetCorner - æˆ‘çš„æ•¸ä½å›æ†¶æ”¶è—ï¼Œçè—æ¯ä¸€å€‹ç¾å¥½ç¬é–“">
    <meta name="keywords" content="æ•¸ä½å›æ†¶,ç…§ç‰‡æ”¶è—,å›æ†¶è† å·,InternetCorner">
    <meta name="author" content="InternetCorner">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="InternetCorner - æ•¸ä½å›æ†¶æ›¸">
    <meta property="og:description" content="æˆ‘çš„æ•¸ä½å›æ†¶æ”¶è—ï¼Œçè—æ¯ä¸€å€‹ç¾å¥½ç¬é–“">
    <meta property="og:type" content="website">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}" onerror="this.style.display='none'">
    
    <!-- Performance Optimization -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="preload" href="{{ url_for('static', filename='css/home.css') }}" as="style">
    <link rel="preload" href="{{ url_for('static', filename='js/home.js') }}" as="script">
</head>
<body>
    <!-- ä¸»å®¹å™¨ -->
    <div class="main-container">
        <!-- ç¶²ç«™æ¨™é¡Œ -->
        <header class="site-title" role="banner">
            <h1>ğŸ”å’Œç¡ç¡ğŸ’¤çš„ç¶²è·¯å°è§’è½</h1>
            <p>å›æ†¶æ—¥è¨˜æœ¬</p>
        </header>

        <!-- æ›¸æœ¬ä¸»é«”å€åŸŸ -->
        <main class="book-section" role="main">
            <!-- æ›¸æœ¬å®¹å™¨ -->
            <div class="book-container">
                <!-- æ›¸æœ¬æœ¬é«” -->
                <div class="book" role="button" tabindex="0" aria-label="æ•¸ä½å›æ†¶æ›¸">
                    <div class="book-cover">
                        <h2>å›æ†¶å°æœ¬æœ¬</h2>
                        <p class="subtitle">æ»‘é¼ æŒ‡ä¸Šå»æˆ–æ˜¯æ‰‹æ©Ÿé»ä¸€ä¸‹æœƒå‡ºç¾é¸é …å–”</p>
                        <div class="book-decoration" aria-hidden="true">
                            <div class="golden-line"></div>
                            <div class="corner-ornament">âœ¦</div>
                        </div>
                    </div>
                </div>

                <!-- æ›¸ç±¤å®¹å™¨ -->
                <div class="bookmarks-container" role="navigation" aria-label="åŠŸèƒ½æ›¸ç±¤">
                    {% for bookmark in bookmarks %}
                    <div class="bookmark bookmark-color-{{ loop.index }}" 
                         data-bookmark-id="{{ bookmark.id }}"
                         data-enabled="{{ bookmark.enabled|lower }}"
                         {% if bookmark.enabled and bookmark.route != '#' %}
                            data-route="{{ url_for(bookmark.route) if bookmark.route != '#' else '#' }}"
                         {% else %}
                            data-route="#"
                         {% endif %}
                         data-title="{{ bookmark.title|e }}"
                         role="button"
                         tabindex="0"
                         aria-label="æ›¸ç±¤: {{ bookmark.title }}{% if not bookmark.enabled %} (å³å°‡æ¨å‡º){% endif %}">
                        
                        <div class="bookmark-tab">
                            <!-- æ›¸ç±¤æ–‡å­—å…§å®¹ -->
                            <div class="bookmark-text">
                                <div class="bookmark-title">{{ bookmark.title }}</div>
                                <div class="bookmark-date">{{ bookmark.date }}</div>
                                {% if bookmark.description %}
                                <div class="bookmark-description" aria-hidden="true">{{ bookmark.description }}</div>
                                {% endif %}
                            </div>
                            
                            <!-- æ›¸ç±¤åœ–æ¨™ -->
                            <div class="bookmark-icon" aria-hidden="true">{{ bookmark.icon }}</div>
                        </div>
                        
                        <!-- å³å°‡æ¨å‡ºå¾½ç«  -->
                        {% if not bookmark.enabled %}
                        <div class="coming-soon-badge" aria-label="å³å°‡æ¨å‡º">æ•¬è«‹æœŸå¾…</div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </main>

        <!-- ç‰ˆæœ¬è³‡è¨Š -->
        <footer class="version-info" role="contentinfo">
            <p>Version 1.0.0 Built for QiQi</p>
        </footer>
    </div>

    <!-- å³å°‡æ¨å‡ºæ¨¡æ…‹æ¡† -->
    <div id="coming-soon-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title">
        <div class="modal-content">
            <div class="modal-icon" aria-hidden="true">ğŸš§</div>
            <h3 id="modal-title">åŠŸèƒ½é–‹ç™¼ä¸­</h3>
            <p id="modal-description">é€™å€‹åŠŸèƒ½æ­£åœ¨åŠªåŠ›é–‹ç™¼ä¸­ï¼Œè«‹è€å¿ƒç­‰å¾…ï¼</p>
            <div class="modal-buttons">
                <button type="button" onclick="closeComingSoonModal()" aria-label="é—œé–‰å°è©±æ¡†">
                    å¥½çš„
                </button>
            </div>
        </div>
    </div>

    <!-- è¼‰å…¥é®ç½©ï¼ˆç”±JavaScriptå‹•æ…‹ç”Ÿæˆï¼‰ -->
    <!-- é€šçŸ¥å®¹å™¨ï¼ˆç”±JavaScriptå‹•æ…‹ç”Ÿæˆï¼‰ -->

    <!-- ç„¡éšœç¤™è·³è½‰é€£çµ -->
    <div class="skip-links" aria-hidden="true">
        <a href="#main-content" class="skip-link">è·³åˆ°ä¸»è¦å…§å®¹</a>
        <a href="#navigation" class="skip-link">è·³åˆ°å°èˆª</a>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/home.js') }}" defer></script>
    
    <!-- çµæ§‹åŒ–æ•¸æ“š (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "InternetCorner",
        "description": "æ•¸ä½å›æ†¶æ”¶è—æ‡‰ç”¨ç¨‹å¼",
        "url": "{{ request.url_root }}",
        "applicationCategory": "LifestyleApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "TWD"
        },
        "author": {
            "@type": "Organization",
            "name": "InternetCorner"
        }
    }
    </script>

    <!-- é é¢è¼‰å…¥æ€§èƒ½è¿½è¹¤ -->
    <script>
        // æ€§èƒ½ç›£æ§
        window.addEventListener('load', function() {
            if (typeof performance !== 'undefined' && performance.timing) {
                const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                console.log(`ğŸ“Š é é¢è¼‰å…¥æ™‚é–“: ${loadTime}ms`);
                
                // æ¨™è¨˜é—œéµæ€§èƒ½æŒ‡æ¨™
                if (performance.mark) {
                    performance.mark('page-loaded');
                }
            }
        });

        // æª¢æ¸¬é—œéµæ¸²æŸ“è·¯å¾‘
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof performance !== 'undefined' && performance.timing) {
                const domTime = performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart;
                console.log(`ğŸ“Š DOM è¼‰å…¥æ™‚é–“: ${domTime}ms`);
            }
        });

        // éŒ¯èª¤è¿½è¹¤
        window.addEventListener('error', function(e) {
            console.error('ğŸ’¥ é é¢éŒ¯èª¤:', {
                message: e.message,
                source: e.filename,
                line: e.lineno,
                column: e.colno,
                stack: e.error ? e.error.stack : null
            });
        });

        // æœªè™•ç†çš„PromiseéŒ¯èª¤
        window.addEventListener('unhandledrejection', function(e) {
            console.error('ğŸ’¥ æœªè™•ç†çš„PromiseéŒ¯èª¤:', e.reason);
        });
    </script>

    <!-- æ¢ä»¶å¼è¼‰å…¥å„ªåŒ–è…³æœ¬ -->
    <script>
        // æª¢æ¸¬ç€è¦½å™¨èƒ½åŠ›ä¸¦å„ªåŒ–
        (function() {
            // æª¢æ¸¬æ˜¯å¦æ”¯æ´ Intersection Observer
            if (!('IntersectionObserver' in window)) {
                console.log('ğŸ“± èˆŠç€è¦½å™¨æª¢æ¸¬ï¼šè¼‰å…¥ polyfill...');
                // é€™è£¡å¯ä»¥è¼‰å…¥ polyfill
            }

            // æª¢æ¸¬æ˜¯å¦ç‚ºè§¸æ‘¸è¨­å‚™
            if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
                document.body.classList.add('touch-device');
                console.log('ğŸ‘† è§¸æ‘¸è¨­å‚™æª¢æ¸¬ï¼šå·²å•Ÿç”¨è§¸æ‘¸å„ªåŒ–');
            }

            // æª¢æ¸¬ç¶²è·¯ç‹€æ³
            if ('connection' in navigator) {
                const connection = navigator.connection;
                if (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g') {
                    document.body.classList.add('slow-connection');
                    console.log('ğŸ“¶ æ…¢é€Ÿç¶²è·¯æª¢æ¸¬ï¼šå·²å•Ÿç”¨ç¯€èƒ½æ¨¡å¼');
                }
            }

            // æª¢æ¸¬é›»æ± ç‹€æ³
            if ('getBattery' in navigator) {
                navigator.getBattery().then(function(battery) {
                    if (battery.level < 0.2 && !battery.charging) {
                        document.body.classList.add('low-battery');
                        console.log('ğŸ”‹ ä½é›»é‡æª¢æ¸¬ï¼šå·²å•Ÿç”¨ç¯€èƒ½æ¨¡å¼');
                    }
                });
            }

            // æª¢æ¸¬å‹•ç•«åå¥½
            if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.body.classList.add('reduced-motion');
                console.log('â™¿ æ¸›å°‘å‹•ç•«åå¥½æª¢æ¸¬ï¼šå·²ç¦ç”¨å‹•ç•«');
            }

            // æª¢æ¸¬è‰²å½©åå¥½
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-theme');
                console.log('ğŸŒ™ æ·±è‰²ä¸»é¡Œåå¥½æª¢æ¸¬ï¼šå·²å•Ÿç”¨æ·±è‰²æ¨¡å¼');
            }

            // æª¢æ¸¬é«˜å°æ¯”åº¦åå¥½
            if (window.matchMedia && window.matchMedia('(prefers-contrast: high)').matches) {
                document.body.classList.add('high-contrast');
                console.log('ğŸ” é«˜å°æ¯”åº¦åå¥½æª¢æ¸¬ï¼šå·²å•Ÿç”¨é«˜å°æ¯”åº¦æ¨¡å¼');
            }
        })();
    </script>

    <!-- Service Worker è¨»å†Šï¼ˆå¦‚æœéœ€è¦é›¢ç·šåŠŸèƒ½ï¼‰ -->
    <script>
        // Service Worker æ”¯æ´æª¢æ¸¬
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // è¨»å†Š service workerï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                navigator.serviceWorker.register('/static/sw.js')
                .then(function(registration) {
                    console.log('ğŸ“± Service Worker è¨»å†ŠæˆåŠŸ:', registration.scope);
                })
                .catch(function(error) {
                    console.log('ğŸ“± Service Worker è¨»å†Šå¤±æ•—:', error);
                });
            });
        }
    </script>

    <!-- é–‹ç™¼æ¨¡å¼èª¿è©¦å·¥å…· -->
    {% if config.DEBUG %}
    <script>
        console.log('ğŸ”§ é–‹ç™¼æ¨¡å¼å·²å•Ÿç”¨');
        console.log('ğŸ’¡ å¯ç”¨çš„èª¿è©¦æŒ‡ä»¤:');
        console.log('  getBookmarkStatus() - æŸ¥çœ‹æ›¸ç±¤ç³»çµ±ç‹€æ…‹');
        console.log('  reinitializeBookmarks() - é‡æ–°åˆå§‹åŒ–æ›¸ç±¤ç³»çµ±');
        console.log('  showComingSoon("æ¸¬è©¦åŠŸèƒ½") - æ¸¬è©¦æ¨¡æ…‹æ¡†');
        console.log('  closeComingSoonModal() - é—œé–‰æ¨¡æ…‹æ¡†');
        
        // å…¨åŸŸèª¿è©¦å‡½æ•¸
        window.debugBookmarks = function() {
            const bookmarks = document.querySelectorAll('.bookmark');
            bookmarks.forEach((bookmark, index) => {
                console.log(`æ›¸ç±¤ ${index + 1}:`, {
                    id: bookmark.dataset.bookmarkId,
                    enabled: bookmark.dataset.enabled,
                    route: bookmark.dataset.route,
                    title: bookmark.dataset.title,
                    element: bookmark
                });
            });
        };
        
        window.debugModal = function() {
            const modal = document.getElementById('coming-soon-modal');
            console.log('æ¨¡æ…‹æ¡†ç‹€æ…‹:', {
                element: modal,
                display: modal ? window.getComputedStyle(modal).display : 'not found',
                classList: modal ? Array.from(modal.classList) : []
            });
        };
        
        console.log('ğŸ” é¡å¤–èª¿è©¦æŒ‡ä»¤: debugBookmarks(), debugModal()');
    </script>
    {% endif %}

    <!-- æ¨£å¼å…§è¯ï¼ˆé‡å°é—œéµ CSSï¼‰ -->
    <style>
        /* é˜²æ­¢ FOUC (Flash of Unstyled Content) */
        .main-container {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .main-container.loaded {
            opacity: 1;
        }
        
        /* è¼‰å…¥æŒ‡ç¤ºå™¨ */
        .loading-fallback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #FFD700;
            font-size: 1.2rem;
            z-index: 9999;
        }
        
        /* ç„¡éšœç¤™è·³è½‰é€£çµ */
        .skip-links {
            position: absolute;
            top: -100px;
            left: 0;
            z-index: 10000;
        }
        
        .skip-link {
            position: absolute;
            top: 0;
            left: 0;
            background: #000;
            color: #fff;
            padding: 8px 16px;
            text-decoration: none;
            font-size: 14px;
            border-radius: 0 0 4px 0;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }
        
        .skip-link:focus {
            transform: translateY(0);
        }
        
        /* éŒ¯èª¤é‚Šç•Œæ¨£å¼ */
        .error-boundary {
            padding: 20px;
            border: 2px solid #ff4757;
            border-radius: 8px;
            background: rgba(255, 71, 87, 0.1);
            color: #ff4757;
            text-align: center;
            margin: 20px;
        }
        
        /* è¼‰å…¥å¤±æ•—æç¤º */
        .load-error {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 71, 87, 0.9);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 9999;
            max-width: 300px;
        }
        
        /* æ…¢é€Ÿç¶²è·¯å„ªåŒ– */
        .slow-connection .book-decoration,
        .low-battery .book-decoration {
            animation: none !important;
        }
        
        .slow-connection .site-title,
        .low-battery .site-title {
            animation: none !important;
        }
    </style>

    <!-- è¼‰å…¥å®Œæˆè…³æœ¬ -->
    <script>
        // é é¢è¼‰å…¥å®Œæˆè™•ç†
        document.addEventListener('DOMContentLoaded', function() {
            // ç§»é™¤è¼‰å…¥æ•ˆæœ
            const mainContainer = document.querySelector('.main-container');
            if (mainContainer) {
                mainContainer.classList.add('loaded');
            }
            
            // ç§»é™¤è¼‰å…¥æŒ‡ç¤ºå™¨
            const loadingFallback = document.querySelector('.loading-fallback');
            if (loadingFallback) {
                loadingFallback.remove();
            }
            
            console.log('âœ¨ é é¢å·²è¼‰å…¥å®Œæˆ');
        });

        // è³‡æºè¼‰å…¥éŒ¯èª¤è™•ç†
        window.addEventListener('error', function(e) {
            if (e.target !== window) {
                // è³‡æºè¼‰å…¥éŒ¯èª¤
                console.error('âŒ è³‡æºè¼‰å…¥å¤±æ•—:', e.target.src || e.target.href);
                
                // é¡¯ç¤ºéŒ¯èª¤æç¤º
                const errorDiv = document.createElement('div');
                errorDiv.className = 'load-error';
                errorDiv.innerHTML = `
                    <strong>è¼‰å…¥éŒ¯èª¤</strong><br>
                    éƒ¨åˆ†è³‡æºè¼‰å…¥å¤±æ•—ï¼Œé é¢åŠŸèƒ½å¯èƒ½å—å½±éŸ¿ã€‚
                    <button onclick="location.reload()" style="margin-left: 10px; padding: 4px 8px; border: none; background: rgba(255,255,255,0.2); color: white; border-radius: 4px; cursor: pointer;">é‡æ–°è¼‰å…¥</button>
                `;
                document.body.appendChild(errorDiv);
                
                // 5ç§’å¾Œè‡ªå‹•ç§»é™¤
                setTimeout(() => {
                    if (document.body.contains(errorDiv)) {
                        document.body.removeChild(errorDiv);
                    }
                }, 5000);
            }
        }, true);
    </script>

    <!-- è¼‰å…¥ä¸­æç¤ºï¼ˆåœ¨JavaScriptè¼‰å…¥å‰é¡¯ç¤ºï¼‰ -->
    <div class="loading-fallback">
        â­ è¼‰å…¥ä¸­...
    </div>
</body>
</html>