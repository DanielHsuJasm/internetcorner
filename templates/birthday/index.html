<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ—¥å›æ†¶ - æ¯ä¸€å¹´çš„ç¾å¥½æ™‚å…‰</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/birthday.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- ç”Ÿæ—¥æ°£çƒèƒŒæ™¯ -->
    <div class="balloons-container">
        <div class="balloon balloon-1">ğŸˆ</div>
        <div class="balloon balloon-2">ğŸˆ</div>
        <div class="balloon balloon-3">ğŸˆ</div>
        <div class="balloon balloon-4">ğŸˆ</div>
        <div class="balloon balloon-5">ğŸˆ</div>
    </div>

    <!-- è¿”å›é¦–é æŒ‰éˆ• -->
    <div class="back-to-home">
        <a href="{{ url_for('home.index') }}" class="back-button">
            <span class="back-icon">ğŸ“š</span>
            <span class="back-text">å›åˆ°æ›¸æœ¬</span>
        </a>
    </div>

    <header>
        <h1>ğŸ‚ ç”Ÿæ—¥å›æ†¶ ğŸ‚</h1>
        <p class="header-subtitle">çè—æ¯ä¸€å¹´çš„ç”Ÿæ—¥æ™‚å…‰</p>
        
        <!-- çµ±è¨ˆè³‡è¨Š -->
        {% if stats.total_photos > 0 %}
        <div class="stats-container">
            <div class="stat-item">
                <span class="stat-number">{{ stats.total_photos }}</span>
                <span class="stat-label">å¼µç…§ç‰‡</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ stats.years_count }}</span>
                <span class="stat-label">å€‹å¹´ä»½</span>
            </div>
            {% if stats.latest_year %}
            <div class="stat-item">
                <span class="stat-number">{{ stats.latest_year }}</span>
                <span class="stat-label">æœ€æ–°å¹´ä»½</span>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </header>

    <main>
        <!-- Flash è¨Šæ¯ -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <ul class="flash-messages">
            {% for category, msg in messages %}
            <li class="flash {{ category }}">{{ msg }}</li>
            {% endfor %}
        </ul>
        {% endif %}
        {% endwith %}

        <!-- ä¸Šå‚³å€åŸŸ -->
        <section class="upload-section">
            <div class="upload-intro">
                <h2>ğŸ“¸ ä¸Šå‚³ç”Ÿæ—¥ç…§ç‰‡</h2>
                <p>è¨˜éŒ„æ¯å¹´çš„ç”Ÿæ—¥æ™‚å…‰ï¼Œè®“å›æ†¶æ°¸é ç¶»æ”¾</p>
            </div>
            
            <form id="upload-form" action="{{ url_for('birthday.upload') }}" method="post" enctype="multipart/form-data">
                <div class="upload-form-grid">
                    <div class="form-group">
                        <label for="file-input" class="file-label">é¸æ“‡ç”Ÿæ—¥ç…§ç‰‡...</label>
                        <input id="file-input" type="file" name="photos" accept="image/*" multiple 
                               title="æ”¯æ´ PNG, JPG, JPEG, GIF æ ¼å¼">
                    </div>
                    
                    <div class="form-group">
                        <label for="birthday-year">ç”Ÿæ—¥å¹´ä»½</label>
                        <input type="number" id="birthday-year" name="birthday_year" 
                               min="1900" max="{{ current_year + 10 }}" 
                               value="{{ current_year if not selected_year else selected_year }}"
                               placeholder="ä¾‹å¦‚: {{ current_year }}">
                    </div>
                    
                    <!-- ğŸ‚ ç¾åŒ–å¾Œçš„ç”Ÿæ—¥æ—¥æœŸæ¬„ä½ -->
                    <div class="form-group">
                        <label for="birthday-date" class="date-label">
                            <span class="label-text">ç”Ÿæ—¥æ—¥æœŸ</span>
                            <span class="label-icon">ğŸ“…</span>
                        </label>
                        <div class="date-input-container">
                            <input type="text" id="birthday-date" name="birthday_date" 
                                   pattern="(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])"
                                   placeholder="MM-DD"
                                   title="è«‹è¼¸å…¥æœˆä»½-æ—¥æœŸæ ¼å¼ï¼Œä¾‹å¦‚ 01-01 æˆ– 06-26"
                                   maxlength="5"
                                   autocomplete="off">
                            <div class="date-examples">
                                <span class="example-item" data-date="01-01">å…ƒæ—¦ ğŸŠ</span>
                                <span class="example-item" data-date="06-26">6/26 ğŸˆ</span>
                                <span class="example-item" data-date="12-25">è–èª• ğŸ„</span>
                            </div>
                        </div>
                        <div class="date-help">
                            <small>ğŸ’¡ é»æ“Šä¸Šæ–¹å¿«é€Ÿé¸æ“‡ï¼Œæˆ–æ‰‹å‹•è¼¸å…¥ MM-DD æ ¼å¼</small>
                        </div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="description">ç…§ç‰‡æè¿° (å¯é¸)</label>
                        <input type="text" id="description" name="description" 
                               placeholder="ä¾‹å¦‚: èˆ‡å®¶äººä¸€èµ·çš„ç”Ÿæ—¥èšæœƒ">
                    </div>
                </div>
                
                <button type="submit" class="upload-button">
                    <span>ğŸ‰ ä¸Šå‚³ç”Ÿæ—¥å›æ†¶</span>
                </button>
            </form>
        </section>

        <!-- å¹´ä»½ç¯©é¸ -->
        {% if years|length > 0 %}
        <section class="filter-section">
            <h3>ğŸ“… æŒ‰å¹´ä»½ç€è¦½</h3>
            <div class="year-filters">
                <a href="{{ url_for('birthday.index') }}" 
                   class="year-filter {% if not selected_year %}active{% endif %}">
                    å…¨éƒ¨
                </a>
                {% for year in years %}
                <a href="{{ url_for('birthday.year_view', year=year) }}" 
                   class="year-filter {% if selected_year == year %}active{% endif %}">
                    {{ year }}
                </a>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- ç…§ç‰‡å±•ç¤ºå€åŸŸ -->
        <section class="photos-section">
            {% if photos|length == 0 %}
                <div class="no-photo">
                    <div class="no-photo-icon">ğŸ‚</div>
                    <h3>é‚„æ²’æœ‰ç”Ÿæ—¥ç…§ç‰‡</h3>
                    <p>ä¸Šå‚³ä½ çš„ç¬¬ä¸€å¼µç”Ÿæ—¥ç…§ç‰‡ï¼Œé–‹å§‹è¨˜éŒ„ç¾å¥½æ™‚å…‰ï¼</p>
                </div>
            {% else %}
                <div class="birthday-gallery">
                    {% for photo in photos %}
                    <div class="photo-card" data-year="{{ photo.birthday_year }}">
                        <div class="photo-frame">
                            <img src="{{ photo.url }}" 
                                 alt="ç”Ÿæ—¥ç…§ç‰‡ {{ photo.birthday_year }}å¹´{% if photo.description %} - {{ photo.description }}{% endif %}"
                                 class="birthday-photo"
                                 onclick="showPhotoModal(this)">
                            
                            <!-- å¹´ä»½æ¨™ç±¤ -->
                            <div class="year-tag">{{ photo.birthday_year }}</div>
                            
                            <!-- åˆªé™¤æŒ‰éˆ• -->
                            <form action="{{ url_for('birthday.delete', photo_id=photo.id) }}" 
                                  method="post" 
                                  class="delete-form"
                                  onsubmit="return confirm('ç¢ºå®šè¦åˆªé™¤é€™å¼µç”Ÿæ—¥ç…§ç‰‡å—ï¼Ÿ');">
                                <button type="submit" class="delete-btn" aria-label="åˆªé™¤ç…§ç‰‡">Ã—</button>
                            </form>
                        </div>
                        
                        <!-- ç…§ç‰‡è³‡è¨Š -->
                        <div class="photo-info">
                            {% if photo.description %}
                            <p class="photo-description">{{ photo.description }}</p>
                            {% endif %}
                            <p class="photo-date">{{ photo.uploaded_at.strftime('%Yå¹´%mæœˆ%dæ—¥') }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% endif %}
        </section>
    </main>

    <!-- ç…§ç‰‡æ”¾å¤§æ¨¡æ…‹æ¡† -->
    <div id="photo-modal" class="photo-modal" onclick="closePhotoModal()">
        <div class="modal-content">
            <img id="modal-image" src="" alt="">
            <div class="modal-info">
                <span id="modal-year"></span>
                <span id="modal-description"></span>
            </div>
            <button class="modal-close" onclick="closePhotoModal()">Ã—</button>
        </div>
    </div>

    <!-- ç”Ÿæ—¥ç¥ç¦ä¿¡ä»¶ -->
    <div class="birthday-card-container" tabindex="0" role="button" aria-label="ç”Ÿæ—¥ç¥ç¦å¡ç‰‡">
        <div class="birthday-card">
            <div class="card-front">
                <div class="cake-icon">ğŸ‚</div>
                <div class="birthday-text">ç”Ÿæ—¥å¿«æ¨‚</div>
            </div>
        </div>
        
        <div class="birthday-message">
            <div class="close-hint">é»æ“Šä»»æ„è™•é—œé–‰ âœ•</div>
            <h3>ğŸ‰ ç”Ÿæ—¥å¿«æ¨‚ï¼</h3>
            <p>é¡˜æ¯ä¸€å¹´çš„ç”Ÿæ—¥éƒ½å……æ»¿æ­¡è²ç¬‘èªï¼Œ</p>
            <p>é¡˜æ¯ä¸€å€‹é¡˜æœ›éƒ½èƒ½å¯¦ç¾ï¼Œ</p>
            <p>é¡˜æ¯ä¸€å¼µç…§ç‰‡éƒ½è¨˜éŒ„è‘—æœ€ç¾å¥½çš„ç¬é–“ã€‚</p>
            <p>è®“æˆ‘å€‘ä¸€èµ·çè—é€™äº›çè²´çš„å›æ†¶ï¼Œ</p>
            <p>è®“æ„›èˆ‡æº«æš–æ°¸é é™ªä¼´è‘—ä½ ï¼</p>
            <div class="signature">
                <p>â€” ä¾†è‡ªç”Ÿæ—¥å›æ†¶çš„æº«æš–ç¥ç¦ ğŸˆ</p>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/birthday.js') }}"></script>
</body>
</html>